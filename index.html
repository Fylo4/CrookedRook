<!DOCTYPE html>
<html>
<head>
    <!--import * as DOMPurify from 'dompurify';-->
    <script type="text/javascript" src="purify.min.js"></script>
    <script src="hjson.js"></script>
    <script src="Squareset.js"></script>
    <script src="Constants.js"></script>
    <script src="bnb_ep_init.js"></script>
    <script src="start_game.js"></script>
    <script src="render-mc.js"></script>
    <script src="make_move.js"></script>
    <script src="refresh_moves.js"></script>
    <script src="style_data.js"></script>
    <script src="random.js"></script>
    <script src="import-export.js"></script>
    <script src="ui.js"></script>
    <script src="site_utils.js"></script>
    <script src="board_utils.js"></script>
    <script src="init.js"></script>

    <script src="boards/CCIT/Crow Chess.js"></script>
    <script src="boards/CCIT/Cannon.js"></script>
    <script src="boards/CCIT/No Step On Snek.js"></script>
    <script src="boards/CCIT/Kitchen.js"></script>
    <script src="boards/CCIT/LeapyMakruk.js"></script>
    <script src="boards/CCIT/Honey Rush.js"></script>
    <script src="boards/CCIT/Segiztas Peak.js"></script>
    <script src="boards/CCIT/Blackroot.js"></script>

    <script src="boards/Chess/Chess.js"></script>
    <script src="boards/Chess/Atomic Chess.js"></script>
    <script src="boards/Chess/Berolina Chess.js"></script>
    <script src="boards/Chess/Chess_on_a_Really_Big_Board.js"></script>
    <script src="boards/Chess/Chess5040.js"></script>
    <script src="boards/Chess/Crazyhouse.js"></script>
    <script src="boards/Chess/Horde_Chess.js"></script>
    <script src="boards/Chess/King of the Hill.js"></script>
    <script src="boards/Chess/Knightmate.js"></script>
    <script src="boards/Chess/Los Alamos.js"></script>
    <script src="boards/Chess/Maharajah.js"></script>
    <script src="boards/Chess/Marseillais Chess.js"></script>
    <script src="boards/Chess/Monster Chess.js"></script>
    <script src="boards/Chess/Omega Chess.js"></script>
    <script src="boards/Chess/Pocket Knight Chess.js"></script>
    <script src="boards/Chess/Spartan Chess.js"></script>
    <script src="boards/Chess/Wildebeest Chess.js"></script>

    <script src="boards/Historical/Chaturanga.js"></script>
    <script src="boards/Historical/Courier Chess.js"></script>
    <script src="boards/Historical/Courier Chess Start.js"></script>
    <script src="boards/Historical/Grant Acedrex.js"></script>

    <script src="boards/Xiangqi/Xiangqi.js"></script>
    <script src="boards/Xiangqi/Janggi.js"></script>
    <script src="boards/Xiangqi/MiniXiangqi.js"></script>
    <script src="boards/Xiangqi/Manchu Chess.js"></script>
    <script src="boards/Xiangqi/5 Tigers.js"></script>
    <script src="boards/Xiangqi/Ajax Xiangqi.js"></script>
    <script src="boards/Xiangqi/Sanho.js"></script>

    <script src="boards/Shogi/Shogi.js"></script>
    <script src="boards/Shogi/Dobutsu.js"></script>
    <script src="boards/Shogi/Simple Shogi.js"></script>
    <script src="boards/Shogi/Micro Shogi.js"></script>
    <script src="boards/Shogi/Mini Shogi.js"></script>
    <script src="boards/Shogi/Kyoto Shogi.js"></script>
    <script src="boards/Shogi/Goro-Goro Shogi.js"></script>
    <script src="boards/Shogi/Rocket Shogi.js"></script>
    <script src="boards/Shogi/Judkins Shogi.js"></script>
    <script src="boards/Shogi/Tori Shogi.js"></script>
    <script src="boards/Shogi/Yari Shogi.js"></script>
    <script src="boards/Shogi/Euro Shogi.js"></script>
    <script src="boards/Shogi/Heian Shogi.js"></script>
    <script src="boards/Shogi/Sho Shogi.js"></script>
    <script src="boards/Shogi/Wa Shogi.js"></script>

    <script src="boards/Compound Chess/Almost Chess.js"></script>
    <script src="boards/Compound Chess/Bird's Chess.js"></script>
    <script src="boards/Compound Chess/Capablanca Chess.js"></script>
    <script src="boards/Compound Chess/Carrera's Chess.js"></script>
    <script src="boards/Compound Chess/Compound Shuffle Chess.js"></script>
    <script src="boards/Compound Chess/Embassy Chess.js"></script>
    <script src="boards/Compound Chess/Gothic Chess.js"></script>
    <script src="boards/Compound Chess/Grand Chess.js"></script>
    <script src="boards/Compound Chess/Shogun Chess.js"></script>

    <script src="boards/SEA/Makruk.js"></script>
    <script src="boards/SEA/Ouk Chaktrang.js"></script>
    <script src="boards/SEA/Sittuyin.js"></script>
    <script src="boards/SEA/Main Chator.js"></script>
    <script src="boards/SEA/Asean Chess.js"></script>

    <script src="boards/other/Congo.js"></script>
    <script src="boards/other/Dragonfly.js"></script>
    <script src="boards/other/Metamachy.js"></script>
    <script src="boards/other/Shako.js"></script>
    <script src="boards/Style.js"></script>

    <title>The Crooked Rook</title>
    <link rel="icon" href="icon.png">
    <link href="style/tcr_style.css" rel="stylesheet"/>
</head>
<body>
    <!-- Modals -->
    <dialog id="modal-about">
        <h1>About TCR</h1>
        <p>Version 0.8.3</p>
        <br />
        <a href="https://discord.gg/NJNXUXqyvr" autofocus>Discord</a>
        <br /> <br />
        <a href="https://drive.google.com/drive/folders/1yB_Elymo0vY33n6xQHWzukDGGkANqPQl">Documentation</a>
        <br /> <br />
        <button onclick="close_modal('about'); open_modal('credits');">Credits</button>
        <br /> <br />
        <button onclick="close_modal('about')">Close</button>
    </dialog>
    
    <dialog id="modal-export">
        <h1>Export</h1>
        <p>Export code copied to clipboard:</p>
        <p id="export_code_p"></p>
        <button onclick="close_modal('export')">Close</button>
    </dialog>
    
    <dialog id="modal-piece">
        <h1 id="piece_modal_name">Piece name</h1>
        <p id="piece_modal_desc">Piece description</p>
        <button onclick="close_modal('piece')">Close</button>
    </dialog>

    <dialog id="modal-profile" style="width: 350px;">
        <h1>Profile</h1>
        <p class="inline">Name:</p>
        <p class="inline name_container hide_name_container">Logged Out</p>
        <input id="name_input" style="display:none;"/>
        <button id="name_btn" onclick="handle_name_btn()">✏️</button>
        <br /> <br />
        <button onclick="close_modal('profile')">Close</button>
    </dialog>

    <dialog id="modal-load" style="width: 450px;">
        <h1>Load Board</h1>
        <label for="from_select">Load from: </label>
        <select autofocus id="from_select" onchange="set_load_input();">
            <option>Canon</option>
            <option>File</option>
            <option>Server</option>
            <option>Import code</option>
        </select>
        <div id="from_canon">
            <br />
            <select id="categoryField" onchange="add_files_to_dropdown()">
                <option value="0">Chess</option>
                <option value="1">Shogi</option>
                <option value="2">Xiangqi</option>
                <option value="7">SEA</option>
                <option value="3">Historical</option>
                <!--<option value="4">Regional</option>-->
                <option value="5">CCIT</option>
                <option value="6">Compound</option>
                <option value="8">Other</option>
            </select>
            <select id="variantField" name="variantField"></select>
            <br /><br />
            <button onclick="load_random_variant(); close_modal('load');">🎲</button>
        </div>
        <div id="from_file">
            <br />
            <label class="custom-file-upload dark" id="variant_file_label">
                <span id="file-selected">Choose File</span>
                <input type="file" id="variant_file" style="display: none" accept=".json, .hjson" />
            </label>
        </div>
        <div id="from_server">
            <br />
            <label for="from_server_code">Board Code: </label>
            <input id="from_server_code">
        </div>
        <div id="from_import">
            <br />
            <label for="from_import_code">Import Code: </label>
            <input id="from_import_code">
        </div>
        <br />
        <button onclick="load_variant(); close_modal('load');">Load</button>
        <button onclick="close_modal('load')">Close</button>
    </dialog>
    
    <dialog id="modal-style" style="width: 500px;">
        <h1>Style Options</h1>
        <div id="style_buttons">
            <br />
            <label for="style_select">Style:</label>
            <select id="style_select" onchange="set_style_type()">
                <option value="checkered">Checkered</option>
                <option value="uncheckered">Uncheckered</option>
                <option value="ashtapada">Ashtapada</option>
                <option value="intersection">Intersection</option>
                <option value="xiangqi">Xiangqi</option>
            </select>
            <div id="style_intersection_div">
                <br /><br />
                <label for="intersection_select">Intersections:</label>
                <select id="intersection_select" onchange="set_intersection_type()">
                    <option value="4-corner">4-corner</option>
                    <option value="dot">Dot</option>
                    <option value="x">X</option>
                </select>
            </div>
            <br /> <br />
            <button onClick="change_zoom(1);  render_entire_board();" class="sq_btn">+</button>
            <button onClick="change_zoom(-1); render_entire_board();" class="sq_btn">-</button>
            <button href="#" id="download_btn" onClick="handle_download_btn()" download="image.png">📷</button>
            <br /> <br />
            <button onClick="line_col='red'"><div class='box red'></div></button>
            <button onClick="line_col='orange'"><div class='box orange'></div></button>
            <button onClick="line_col='yellow'"><div class='box yellow'></div></button>
            <button onClick="line_col='green'"><div class='box green'></div></button>
            <button onClick="line_col='blue'"><div class='box blue'></div></button>
            <button onClick="line_col='purple'"><div class='box purple'></div></button>
            <br /> <br />
            <input type="checkbox" id="attacked_squares_cb" onchange="refresh_checkboxes()">
            <label for="attacked_squares_cb">Attacked squares</label>
            <br />
            <input type="checkbox" id="check_indicator_cb" checked onchange="refresh_checkboxes()">
            <label for="check_indicator_cb">Check indicator</label>
            <br />
            <input type="checkbox" id="movable_pieces_cb" onchange="refresh_checkboxes()">
            <label for="movable_pieces_cb">Movable pieces</label>
            <br />
            <input type="checkbox" id="last_moved_cb" checked onchange="refresh_checkboxes()">
            <label for="last_moved_cb">Last moved piece</label>
            <br />
            <input type="checkbox" id="highlight_cb" checked onchange="refresh_checkboxes()">
            <label for="highlight_cb">Highlighted Squares</label>
            <br />
            <input type="checkbox" id="flip_opp_cb" onchange="refresh_checkboxes()">
            <label for="flip_opp_cb">Flip opponent</label>
            <br />
            <input type="checkbox" id="square_names_cb" onchange="refresh_checkboxes()">
            <label for="square_names_cb">Square names</label>
            <br />
            <input type="checkbox" id="flip_board_cb" onchange="refresh_checkboxes()">
            <label for="flip_board_cb">Flip board</label>
            <br /> <br />
            <button onclick="handle_advanced_style_btn()">Advanced Style Options</button>
            <br /> <br />
            <div id="style_div" style="display:none;">
                <table class="style-table">
                    <tr>
                        <th>White Pieces</th>
                        <th>Black Pieces</th>
                        <th>Neutral Pieces</th>
                    </tr>
                    <tr>
                        <td><input id="style_piece_w" type="color"></td>
                        <td><input id="style_piece_b" type="color"></td>
                        <td><input id="style_piece_n" type="color"></td>
                    </tr>
                </table>
                <br /><br />
                <table class="style-table">
                    <tr>
                        <th>Background</th>
                        <th>Hands</th>
                    </tr>
                    <tr>
                        <td><input id="style_bg" type="color"></td>
                        <td><input id="style_hand" type="color"></td>
                    </tr>
                </table>
                <br /><br />
                <table class="style-table">
                    <tr>
                        <th>Square Type</th>
                        <th>Light</th>
                        <th>Dark</th>
                    </tr>
                    <tr>
                        <td>Default</td>
                        <td><input id="style_sq_light" type="color"></td>
                        <td><input id="style_sq_dark" type="color"></td>
                    </tr>
                    <tr>
                        <td>Highlight 1</td>
                        <td><input id="style_hi_light" type="color"></td>
                        <td><input id="style_hi_dark" type="color"></td>
                    </tr>
                    <tr>
                        <td>Highlight 2</td>
                        <td><input id="style_hi2_light" type="color"></td>
                        <td><input id="style_hi2_dark" type="color"></td>
                    </tr>
                    <tr>
                        <td>Mud</td>
                        <td><input id="style_md_light" type="color"></td>
                        <td><input id="style_md_dark" type="color"></td>
                    </tr>
                    <tr>
                        <td>Ethereal</td>
                        <td><input id="style_et_light" type="color"></td>
                        <td><input id="style_et_dark" type="color"></td>
                    </tr>
                    <tr>
                        <td>Pacifist</td>
                        <td><input id="style_pa_light" type="color"></td>
                        <td><input id="style_pa_dark" type="color"></td>
                    </tr>
                    <tr>
                        <td>Sanctuary</td>
                        <td><input id="style_sa_light" type="color"></td>
                        <td><input id="style_sa_dark" type="color"></td>
                    </tr>
                </table>
                <br />
                <button onclick="export_style()">Save Style</button>
                <br /><br />
                <button onclick="import_style()">Load Style</button>
                <label class="custom-file-upload dark" id="variant_file_label">
                    <span id="style-selected">Choose File</span>
                    <input type="file" id="style_file" style="display: none" accept=".json, .hjson" />
                </label>
                <br /><br />
            </div>
        </div>
        <button onclick="close_modal('style')">Close</button>
    </dialog>

    <dialog id="modal-credits">
        <h1>Credits</h1>
        <p>Created by Fylo</p>
        <p>Most sprites come from <a href="https://gitlab.com/zulban/chesscraft-creative-commons/-/tree/master/pieces">ChessCraft Creative Commons</a></p>
        <p>Hidetchi sprites by <a href="https://boardgamegeek.com/user/jureboga">jureboga</a>, adapted from Hidetchi's designs. <a href="https://boardgamegeek.com/filepage/241678/shogi-more-chess-hidetchis-internationalized-piece">Link</a></p>
        <p>SEA boards created by skyhistory</p>
        <p>All other default boards by Ristet or Fylo</p>
        <p>Board color palette by Z</p>
        <p>Style by Sharp-Shark and Fylo</p>
        <button onclick="close_modal('credits')">Close</button>
    </dialog>

    
    <dialog id="modal-newgame">
        <h1>Create </h1>
        <label for="board_name">Board Code:</label>
        <input id="board_name">
        <br /><br />
        <label for="color_sel">Play as:</label>
        <select id="color_sel">
            <option value="r">Random</option>
            <option value="w">White</option>
            <option value="b">Black</option>
        </select>
        <br /><br />
        <!-- <label for="clock_sel">Clock:</label>
        <select id="clock_sel" onchange="set_clock_inputs();">
            <option value="none">No clock</option>
            <option value="inc">Increment</option>
        </select>
        <br /><br />
        <div id="increment_div">
            <input id="clock_start" type="number" style="width: 50px; margin-left: 20px;"> min +
            <input id="clock_inc" type="number" style="width: 50px"> sec
            <br /><br />
        </div>
        <input type="checkbox" id="private_room" onchange="set_private_input()">
        <label for="private_room">Private room</label>
        <br /><br />
        <div id="private_code_div">
            <label for="private_code">Room code: </label>
            <input id="private_code">
            <br /><br />
        </div>
        <input type="checkbox" id="save_match">
        <label for="save_match">Save match to database</label>
        <br /><br /> -->
        <button onclick="add_lobby(); close_modal('newgame')">Start Room</button>
        <button onclick="close_modal('newgame')">Close</button>
    </dialog>


    <!--Navbar-->
    <nav class="navbar">
        <div class="site-title">
            <img src="logo_50.png" />
            <p>The Crooked Rook</p>
        </div>
        <a href="#" class="hamburger">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </a>
        <div class="navbar-links">
            <a href="#" onclick="open_modal('load')">Load</a>
            <a href="#" id="board_page_button" onclick="board_page()">Board</a>
            <a href="#" id="lobby_page_button" onclick="lobby_page()">Lobby</a>
            <a href="#" onclick="open_modal('about')">About</a>
            <div class="dropdown">
                <a href="#" class="dropdown_button">
                    <p class="name_container">Logged Out</p>
                    <i class="fa fa-caret-down"></i>
                </a>
                <div class="dropdown_content">
                    <a href="#" id="user_profile" onclick="open_modal('profile')">Profile</a>
                    <a href="#" id="user_log_out" onclick="sign_out()">Log out</a>
                    <!-- <a href="#" id="user_anonymous" onclick="sign_in_anonymously()">Log in anonymously</a> -->
                    <a href="#" id="user_google" onclick="sign_in_google()">Log in with Google</a>
                </div>
            </div>
            <div class="dropdown">
                <a href="#" class="dropdown_button">
                    Settings
                    <i class="fa fa-caret-down"></i>
                </a>
                <div class="dropdown_content right">
                    <select class="hidden">
                        <option>English</option>
                    </select>
                    <a href="#" onclick="open_modal('style')">Style</a>
                </div>
            </div>
        </div>
    </nav>

    <div style="padding: 20px">
        <div id="message_div"></div>
        <!--Lobby-->
        <div id="lobby_section" style="display: none;">
            <p>You must be logged in to access multiplayer features</p>
            <p>There are several known bugs with multiplayer. I need to completely redo my database code. Until then, don't expect it to be perfect.</p>
            <button onclick="open_modal('newgame')">Create Room</button>
            <br /><br />
            <table id="lobby_table">
                <tr>
                    <th>Board Name</th>
                    <th>Creator</th>
                    <th>Creator's Color</th>
                    <th>Join</th>
                </tr>
            </table>
            <br /><br />
            <button onclick="handle_refresh_lobby_button()">Refresh</button>
        </div>
        
        <!--Board-->
        <div id="board_section">

            <h2 id="board_name_header">Board Name</h2>
            <p id="board_author_header">Board Author</p>
            <p id="board_description_header">Board Description</p>
            <button onclick="download_variant();">Download</button>
            <button onclick="handle_inspect_button()">🔍</button>
            <p id="inspect_text" style="display: none">Click on any piece to inspect it</p>
            
            <!-- <button onClick="">End turn</button> -->
            <br /> <br />
            <div id="center_div">
                <div id="board_and_history_div">
                    <p id="multiplayer_label">Mode: Single-player</p>
                    <p id="top_player_label"></p>
                    <!--Board canvases-->
                    <div id="board_canvas_container">
                        <canvas id="board_canvas_0" width="400" height="0" oncontextmenu="return false;" class="board_canvas" style="z-index: 0;"></canvas>
                        <canvas id="board_canvas_1" width="400" height="0" oncontextmenu="return false;" class="board_canvas" style="z-index: 1;"></canvas>
                        <canvas id="board_canvas_2" width="400" height="0" oncontextmenu="return false;" class="board_canvas" style="z-index: 2;"></canvas>
                        <canvas id="board_canvas_3" width="400" height="0" oncontextmenu="return false;" class="board_canvas" style="z-index: 3;"></canvas>
                        <canvas id="board_canvas_4" width="400" height="0" oncontextmenu="return false;" class="board_canvas" style="z-index: 4;"></canvas>
                        <canvas id="board_canvas_5" width="400" height="0" oncontextmenu="return false;" class="board_canvas" style="z-index: 5;"></canvas>
                    </div>
                    <!--Move history-->
                    <div id="history_div">
                        <button onclick="up_arrow_click();" class="arrow_btn">&uarr;</button>
                        <button onclick="left_arrow_click();" class="arrow_btn">&larr;</button>
                        <button onclick="right_arrow_click();" class="arrow_btn">&rarr;</button>
                        <button onclick="down_arrow_click();" class="arrow_btn">&darr;</button>
                        <button onclick="handle_export_btn()">Export</button>
                        <hr />
                        <div id="move_history"></div>
                    </div>
                    <br>
                    <p id="bottom_player_label"></p>
                    <p id="turn_indicator">Turn: N/A</p>
                </div>
            </div>
            <button id="resign_btn" onclick="resign()" style="display: none;">Resign</button>
            <div id="upload_div" style="display: none;">
                <br />
                <p>Boards cannot be modified once they are uploaded - make sure the board is finished before uploading!</p>
                <button onclick="handle_upload_btn()">Upload to Server</button>
                <input type="text" id="upload_name" placeholder="Board code">
            </div>

            <div id="export_div" style="display: none">
                <h2>Export History</h2>
                <button onclick="hide_export_div()">Hide</button>
                <button>Copy</button>
                <p id="export_p"></p>
            </div>
        </div>
    </div>

    <div id="imageDiv" style="Display: none"></div>
    <canvas id="blend_canvas" style="Display: none" width="400" height="400"></canvas>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
        // Import the functions you need from the SDKs you need
        // import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBBbEUHGhTCavfixQmyBqMOEhJ-s9xfbsU",
            authDomain: "crooked-rook.firebaseapp.com",
            databaseURL: "https://crooked-rook-default-rtdb.firebaseio.com",
            projectId: "crooked-rook",
            storageBucket: "crooked-rook.appspot.com",
            messagingSenderId: "612890880400",
            appId: "1:612890880400:web:bf191526f0789a2ade2b15"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
    </script>
    <script src="firebase-code.js"></script>
    <script>page_init()</script>
</body>
</html>